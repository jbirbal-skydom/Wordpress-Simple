version: "3.1"

networks:
  frontend:
  backend:
  main:

services:
  # netdata:
  #   image: netdata/netdata
  #   container_name: netdata
  #   hostname: example.com # set to fqdn of host
  #   ports:
  #       - 19999:19999
  #   restart: unless-stopped
  #   cap_add:
  #       - SYS_PTRACE
  #   security_opt:
  #       - apparmor:unconfined
  #   volumes:
  #       - netdataconfig:/etc/netdata
  #       - netdatalib:/var/lib/netdata
  #       - netdatacache:/var/cache/netdata
  #       - /etc/passwd:/host/etc/passwd:ro
  #       - /etc/group:/host/etc/group:ro
  #       - /proc:/host/proc:ro
  #       - /sys:/host/sys:ro
  #       - /etc/os-release:/host/etc/os-release:ro
  #   networks:
  #     - backend
  #     - main

  phpmyadmin:
      image: phpmyadmin
      restart: always
      environment:
        PMA_ARBITRARY: 1
      ports:
        - 8183:80
      networks:
        - backend
        - main
  
  npm:
    image: 'jc21/nginx-proxy-manager:latest'
    restart: always
    ports:
      # Public HTTP Port:
      - '80:80'
      # Public HTTPS Port:
      - '443:443'
      # Admin Web Port:
      - '81:81'
      # Add any other Stream port you want to expose
      # - '21:21' # FTP
    environment:
      # These are the settings to access your db
      DB_MYSQL_HOST: "db_skydom"
      DB_MYSQL_PORT: 3306
      DB_MYSQL_USER: "Gp8Ajj4BmjXK6hq"
      DB_MYSQL_PASSWORD: "X9dZFKCJKLZ8acH"
      DB_MYSQL_NAME: "npm"
      # If you would rather use Sqlite uncomment this
      # and remove all DB_MYSQL_* lines above
      # DB_SQLITE_FILE: "/data/database.sqlite"
      # Uncomment this if IPv6 is not enabled on your host
      DISABLE_IPV6: 'true'
    volumes:
      - data_npm:/data
      - letsencrypt_npm:/etc/letsencrypt
    depends_on:
      - db_skydom
    networks:
      - frontend
      - backend
      - main




  db_skydom:
    image: 'jc21/mariadb-aria:latest'
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: 'NyoaApFjsiinakhCXuSK'
      MYSQL_DATABASE: 'npm'
      MYSQL_USER: 'Gp8Ajj4BmjXK6hq'
      MYSQL_PASSWORD: 'X9dZFKCJKLZ8acH'
    volumes:
      -  db_npm:/var/lib/mysql
    networks:
      - backend
    ports:
      - 3306:3306


volumes:
    db_skydom:
    data_npm:
    letsencrypt_npm:
    # netdataconfig:
    # netdatalib:
    # netdatacache:

# ----------------- Note, that the NGINX proxy manager is running in a docker container, 
#                   so using the IP address 127.0.0.1 
#                   will NOT refer to the host OS IP address, 
#                   but the containerâ€™s internal address.
 #                       ufw allow 80,81,443,3306,8183,9080,8090,8092,8094/tcp
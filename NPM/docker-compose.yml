version: "3.1"

networks:
  frontend:
    name: frontend
  backend:
    name: backend


services:
  # netdata:
  #   image: netdata/netdata
  #   container_name: netdata
  #   hostname: example.com # set to fqdn of host
  #   ports:
  #       - 19999:19999
  #   restart: unless-stopped
  #   cap_add:
  #       - SYS_PTRACE
  #   security_opt:
  #       - apparmor:unconfined
  #   volumes:
  #       - netdataconfig:/etc/netdata
  #       - netdatalib:/var/lib/netdata
  #       - netdatacache:/var/cache/netdata
  #       - /etc/passwd:/host/etc/passwd:ro
  #       - /etc/group:/host/etc/group:ro
  #       - /proc:/host/proc:ro
  #       - /sys:/host/sys:ro
  #       - /etc/os-release:/host/etc/os-release:ro
  #   networks:
  #     - backend
  #     - main

  phpmyadmin:
      image: 'phpmyadmin:5.2.1'
      restart: always
      container_name: php
      environment:
        - PMA_ARBITRARY=1
        - MYSQL_ROOT_PASSWORD=${DB_ROOT_PASSWORD}
        - PMA_PORT=3306
        - PMA_HOST=db_skydom
      ports:
        - 8183:80
      networks:
        - backend
        - frontend
      depends_on:
        - db_skydom

  
  npm:
    image: 'jc21/nginx-proxy-manager:latest'
    restart: always
    ports:
      # Public HTTP Port:
      - '80:80'
      # Public HTTPS Port:
      - '443:443'
      # Admin Web Port:
      - '81:81'
      # Add any other Stream port you want to expose
      # - '21:21' # FTP
    container_name: nginx
    environment:
      # These are the settings to access your db
      DB_MYSQL_HOST: db_skydom
      DB_MYSQL_PORT: 3306
      DB_MYSQL_USER: "${DB_USER_NAME}"
      DB_MYSQL_PASSWORD: "${DB_USER_PASSWORD}"
      DB_MYSQL_NAME: "${DB_NAME}"
      # If you would rather use Sqlite uncomment this
      # and remove all DB_MYSQL_* lines above
      # DB_SQLITE_FILE: "/data/database.sqlite"
      # Uncomment this if IPv6 is not enabled on your host
      # DISABLE_IPV6: 'true'
    volumes:
      - data_npm:/data
      - letsencrypt_npm:/etc/letsencrypt
    depends_on:
      - db_skydom
    networks:
      - frontend
      - backend





  db_skydom:
    image: 'jc21/mariadb-aria:latest'
    restart: always
    container_name: db_skydom
    command: [
        '--default_authentication_plugin=mysql_native_password',
        '--character-set-server=utf8mb4',
        '--collation-server=utf8mb4_unicode_ci'
    ]
    environment:
      MYSQL_DATABASE: "${DB_NAME}"
      MYSQL_ROOT_PASSWORD: "${DB_ROOT_PASSWORD}"
      MYSQL_USER: "${DB_USER_NAME}"
      MYSQL_PASSWORD: "${DB_USER_PASSWORD}"
    volumes:
      -  db_skydom:/var/lib/mysql
    networks:
      - backend
      - frontend
    ports:
      - 3306:3306


volumes:
    db_skydom:
    data_npm:
    letsencrypt_npm:
    # netdataconfig:
    # netdatalib:
    # netdatacache:

# ----------------- Note, that the NGINX proxy manager is running in a docker container, 
#                   so using the IP address 127.0.0.1 
#                   will NOT refer to the host OS IP address, 
#                   but the containerâ€™s internal address.
 #                       ufw allow 80,81,443,3306,8183,9080,8090,8092,8094/tcp
